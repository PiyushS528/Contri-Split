<!doctype html>
<html>
	<head>
		<title> Contri split </title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width; initial-scale=1">
		
		<style type="text/css">
			body, html {
				background: #000000;
				color: #ffffff;
			}
			#person_list {
				border: 1px solid #ffffff;
				spacing: 5px;
			}
			#person_list th, #person_list td {
				border: 1px solid #ffffff;
				padding: 5px;
			}
			.name_input {
				width: 10em;
			}
			.single_expense_container {
				white-space: nowrap;
			}
			.single_expense_input {
				width: 6em;
			}
			.good {
				color: #7fff7f;
			}
			.bad {
				color: #ff7f7f;
			}
		</style>
	</head>
	<body onload="addPerson()">
		<div id="container">
			<table id="person_list" cellspacing='5'>
				<tr id="heading">
					<th> </th>
					<th> No. </th>
					<th> Name </th>
					<th> Spent </th>
					<th> Total Spent </th>
					<th> <span class="bad">To give (-)</span> / <span class="good">To get (+)</span></th>
				</tr>
			</table>
			<button id="add_person" class="add_remove_button" onclick="addPerson()"> &plus; </button>
		</div>

		<script type="text/javascript">
			var personObj = {
				name: "",
				spent: [],
				totalspent: 0,
				toget: 0
			};
			var personList = [];
			function addNewExpense (buttonElement, ignoreFocus) {
				var spentcontainer = buttonElement.parentElement.firstElementChild;
				var expense = document.createElement ("div");
				expense.setAttribute ("class", "single_expense_container");

				var expenseinput = document.createElement ("input");
				expenseinput.setAttribute ("type", "number");
				expenseinput.setAttribute ("class", "box_input single_expense_input");
				expenseinput.setAttribute ("onchange", "reeval()");
				expense.appendChild(expenseinput);

				var removeExpenseButton = document.createElement ("button");
				removeExpenseButton.setAttribute ("class", "add_remove_button remove_expense_button");
				removeExpenseButton.setAttribute ("onclick", "removeExpense(this)");
				removeExpenseButton.innerHTML = "&times;";
				expense.appendChild(removeExpenseButton);
				spentcontainer.appendChild(expense);

				if (!ignoreFocus) expenseinput.focus();
			}
			function removeExpense (buttonElement) {
				var expense = buttonElement.parentElement;
				expense.parentElement.removeChild(expense);
				reeval();
			}
			function removePerson (buttonElement) {
				var personRow = buttonElement.parentElement.parentElement;
				personRow.parentElement.removeChild(personRow);
				reeval();
			}
			function initSpentBox(cell) {
				var spentcontainer = document.createElement ("div");
				spentcontainer.setAttribute ("class", "spent_container");
				cell.appendChild(spentcontainer);

				var addButton = document.createElement ("button");
				addButton.setAttribute ("class", "add_remove_button remove_expense_button");
				addButton.setAttribute ("onclick", "addNewExpense(this)");
				addButton.innerHTML = "&plus;";
				cell.appendChild(addButton);

				addNewExpense(addButton, true);
			}
			function round2(n) {
				n *= 100;
				n = Math.round(n);
				n /= 100;
				return n;
			}
			function addPerson() {
				var personList = document.getElementById("person_list");

				var newRow = document.createElement ("tr");
				newRow.setAttribute ("class", "person_row");

				var removePersonCell = document.createElement ("td");
				var removePersonButton = document.createElement ("button");
				removePersonButton.setAttribute ("class", "add_remove_button remove_expense_button");
				removePersonButton.setAttribute ("onclick", "removePerson(this)");
				removePersonButton.innerHTML = "&times;";
				removePersonCell.appendChild(removePersonButton);
				newRow.appendChild(removePersonCell);
				var srno = document.createElement ("td");
				newRow.appendChild(srno);

				var nameCell = document.createElement ("td");
				var nameInput = document.createElement ("input");
				nameInput.setAttribute ("type", "text");
				nameInput.setAttribute ("class", "box_input name_input");
				nameCell.appendChild(nameInput);
				newRow.appendChild(nameCell);

				var spentCell = document.createElement ("td");
				initSpentBox(spentCell);
				newRow.appendChild(spentCell);

				var totalSpentCell = document.createElement ("td");
				newRow.appendChild(totalSpentCell);

				var toGetCell = document.createElement ("td");
				newRow.appendChild(toGetCell);

				personList.appendChild(newRow);
				reeval();
			}
			function reeval() {
				var personRows = document.getElementsByClassName("person_row");
				var individualExpenses = [];
				var totalExpenses = 0;
				var averageExpense = 0;

				if (personRows.length <= 0) return;

				for (var i = 0; i < personRows.length; ++i) {
					personRows[i].children[1].innerHTML = i+1;
					var expenses = personRows[i].children[3].children[0].children;
					individualExpenses.push(0);
					for (var j = 0; j < expenses.length; ++j) {
						var singleExpenseValue = expenses[j].children[0].value;
						if(singleExpenseValue) individualExpenses[i] += parseFloat(singleExpenseValue);
					}
					totalExpenses += individualExpenses[i];
				}

				averageExpense = totalExpenses / personRows.length;

				for (var i = 0; i < personRows.length; ++i) {
					personRows[i].children[4].innerHTML = individualExpenses[i];
					var toget = round2(individualExpenses[i] - averageExpense);
					var togetSpan = document.createElement ("span");
					if (toget > 0) {
						togetSpan.setAttribute ("class", "to_get good");
						togetSpan.innerHTML = "&plus;" + toget;
					}
					else if (toget < 0) {
						togetSpan.setAttribute ("class", "to_get bad");
						togetSpan.innerHTML = toget;
					}
					else {
						togetSpan.setAttribute ("class", "to_get neutral");
						togetSpan.innerHTML = toget;
					}
					

					personRows[i].children[5].innerHTML = "";
					personRows[i].children[5].appendChild(togetSpan);
				}
			}
		</script>
	</body>
</html>